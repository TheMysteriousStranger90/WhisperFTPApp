<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WhisperFTPApp.ViewModels"
             xmlns:global="clr-namespace:WhisperFTPApp.Converters"
             x:DataType="vm:ScanWindowViewModel"
             x:Class="WhisperFTPApp.Views.ScanView">

    <Border Classes="panel" Padding="16">
        <DockPanel>
            <!-- Header -->
            <Border Classes="panel" DockPanel.Dock="Top" Padding="16" Margin="0,0,0,16">
                <StackPanel Spacing="12">
                    <TextBlock Text="{DynamicResource WifiScanner}"
                             FontSize="24"
                             FontWeight="SemiBold"/>

                    <!-- Control Buttons -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Command="{Binding StartScanCommand}"
                                Classes="primary"
                                IsEnabled="{Binding !IsScanning}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="{StaticResource RefreshIcon}"/>
                                <TextBlock Text="{DynamicResource StartHybridScan}"/>
                            </StackPanel>
                        </Button>

                        <Button Command="{Binding StopScanCommand}"
                                Classes="danger"
                                IsEnabled="{Binding IsScanning}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="{StaticResource StopIcon}"/>
                                <TextBlock Text="{DynamicResource StopScan}"/>
                            </StackPanel>
                        </Button>

                        <Button Command="{Binding ClearResultsCommand}"
                                IsEnabled="{Binding !IsScanning}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                <TextBlock Text="{DynamicResource Clear}"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Info Banner -->
                    <Border Background="#56001f" Padding="12" CornerRadius="6" Margin="0,8,0,0">
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
                                          Foreground="White"
                                          Width="20"
                                          Height="20"/>
                                <TextBlock Text="{DynamicResource HybridScanMode}"
                                          Foreground="White"
                                          FontSize="14"
                                          FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Spacing="4" Margin="32,0,0,0">
                                <TextBlock Text="{DynamicResource WiFiDiscovery}"
                                          TextWrapping="Wrap"
                                          Foreground="White"
                                          FontSize="12"/>
                                <TextBlock Text="{DynamicResource FtpScanning}"
                                          TextWrapping="Wrap"
                                          Foreground="White"
                                          FontSize="12"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Statistics Panel -->
                    <Border Classes="panel" Padding="12" Background="#10FFFFFF" Margin="0,8,0,0">
                        <Grid ColumnDefinitions="*,*,*,*">
                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="{DynamicResource NetworksFound}" FontSize="11" Opacity="0.7"/>
                                <TextBlock Text="{Binding FoundNetworksCount}" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Spacing="4">
                                <TextBlock Text="{DynamicResource HostsScanned}" FontSize="11" Opacity="0.7"/>
                                <TextBlock Text="{Binding ScannedHostsCount}" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <TextBlock Text="{DynamicResource FtpServersLabel}" FontSize="11" Opacity="0.7"/>
                                <TextBlock Text="{Binding FoundFtpServersCount}" FontSize="20" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Grid.Column="3" Spacing="4">
                                <TextBlock Text="{DynamicResource ScanModeLabel}" FontSize="11" Opacity="0.7"/>
                                <TextBlock Text="{Binding ScanMode}" FontSize="14" FontWeight="Bold"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Progress Bar -->
                    <ProgressBar Value="{Binding ScanProgress}"
                               Maximum="100"
                               IsVisible="{Binding IsScanning}"
                               Height="4"/>
                </StackPanel>
            </Border>

            <!-- Status Bar -->
            <Border Classes="panel" DockPanel.Dock="Bottom" Padding="16,8" Margin="0,16,0,0">
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <Panel Width="24" Height="24" IsVisible="{Binding IsScanning}">
                        <PathIcon Data="{StaticResource RefreshIcon}">
                            <PathIcon.RenderTransform>
                                <RotateTransform/>
                            </PathIcon.RenderTransform>
                            <PathIcon.Styles>
                                <Style Selector="PathIcon">
                                    <Style.Animations>
                                        <Animation Duration="0:0:1" IterationCount="Infinite">
                                            <KeyFrame Cue="0%">
                                                <Setter Property="RotateTransform.Angle" Value="0"/>
                                            </KeyFrame>
                                            <KeyFrame Cue="100%">
                                                <Setter Property="RotateTransform.Angle" Value="360"/>
                                            </KeyFrame>
                                        </Animation>
                                    </Style.Animations>
                                </Style>
                            </PathIcon.Styles>
                        </PathIcon>
                    </Panel>
                    <TextBlock Text="{Binding StatusMessage}"
                             FontSize="13"
                             TextWrapping="Wrap"
                             VerticalAlignment="Center"
                             FontFamily="Consolas, Courier New, monospace"/>
                </StackPanel>
            </Border>

            <!-- Main Content - Tabs -->
            <TabControl Margin="0,8">
                <!-- Available Networks Tab -->
                <TabItem Header="{DynamicResource AvailableNetworksTab}">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Top" Spacing="8" Margin="0,0,0,8">
                            <!-- Info Panel -->
                            <Border Classes="panel" Padding="12">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{DynamicResource TotalNetworksLabel}"
                                               FontSize="14"
                                               FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Networks.Count}"
                                               FontSize="14"
                                               FontWeight="Bold"
                                               Foreground="#4CAF50"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <DataGrid ItemsSource="{Binding Networks}"
                                SelectedItem="{Binding SelectedNetwork}"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                SelectionMode="Single">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="{DynamicResource SSID}"
                                                  Binding="{Binding SSID}"
                                                  Width="200"/>
                                <DataGridTextColumn Header="{DynamicResource BSSID}"
                                                  Binding="{Binding BSSID}"
                                                  Width="150"/>
                                <DataGridTextColumn Header="{DynamicResource Signal}"
                                                  Binding="{Binding SignalStrength, StringFormat='{}{0} dBm'}"
                                                  Width="100"/>
                                <DataGridTextColumn Header="{DynamicResource Channel}"
                                                  Binding="{Binding Channel}"
                                                  Width="80"/>
                                <DataGridTextColumn Header="{DynamicResource Security}"
                                                  Binding="{Binding SecurityType}"
                                                  Width="150"/>
                                <DataGridTemplateColumn Header="{DynamicResource FtpStatus}" Width="150">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ScanStatus}"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Center">
                                                <TextBlock.Foreground>
                                                    <MultiBinding Converter="{x:Static global:ScanStatusColorConverter.Instance}">
                                                        <Binding Path="ScanStatus"/>
                                                    </MultiBinding>
                                                </TextBlock.Foreground>
                                            </TextBlock>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="{DynamicResource LastSeen}"
                                                  Binding="{Binding LastSeen, StringFormat='{}{0:HH:mm:ss}'}"
                                                  Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </TabItem>

                <!-- Connected Networks Tab -->
                <TabItem Header="{DynamicResource CurrentNetworkTab}">
                    <DataGrid ItemsSource="{Binding ConnectedNetworks}"
                            AutoGenerateColumns="False"
                            IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource SSID}"
                                              Binding="{Binding SSID}"
                                              Width="180"/>
                            <DataGridTextColumn Header="{DynamicResource IPAddress}"
                                              Binding="{Binding IpAddress}"
                                              Width="140"/>
                            <DataGridTextColumn Header="{DynamicResource Gateway}"
                                              Binding="{Binding Gateway}"
                                              Width="140"/>
                            <DataGridTextColumn Header="{DynamicResource Subnet}"
                                              Binding="{Binding SubnetMask}"
                                              Width="140"/>
                            <DataGridTemplateColumn Header="{DynamicResource FtpStatus}" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                                            <Ellipse Width="10" Height="10"
                                                   Fill="{Binding HasOpenFtp, Converter={x:Static global:FtpStatusConverter.Instance}}"/>
                                            <TextBlock Text="{Binding ScanStatus}" FontSize="11"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="{DynamicResource FtpServer}"
                                              Binding="{Binding FtpServerAddress}"
                                              Width="140"/>
                            <DataGridTextColumn Header="{DynamicResource Speed}"
                                              Binding="{Binding Speed}"
                                              Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>

                <!-- FTP Servers Tab -->
                <TabItem Header="{DynamicResource FtpServersTab}">
                    <DockPanel>
                        <Border Classes="panel" DockPanel.Dock="Top" Padding="12" Margin="0,0,0,8">
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <Button Command="{Binding ConnectToFtpServerCommand}"
                                            Classes="primary"
                                            IsEnabled="{Binding SelectedFtpServer, Converter={x:Static ObjectConverters.IsNotNull}}">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <PathIcon Data="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-1 12H5V8h14v10z" Width="16" Height="16"/>
                                            <TextBlock Text="{DynamicResource ViewServerDetails}"/>
                                        </StackPanel>
                                    </Button>
                                    <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                        <TextBlock Text="{DynamicResource FoundLabel}" FontSize="13"/>
                                        <TextBlock Text="{Binding FtpServers.Count}" FontWeight="Bold" Foreground="#4CAF50" FontSize="13"/>
                                        <TextBlock Text="{DynamicResource ServersInNetwork}" FontSize="13"/>
                                    </StackPanel>
                                </StackPanel>

                                <Border Background="#222" Padding="8" CornerRadius="4">
                                    <TextBlock Text="{DynamicResource InfoCurrentNetwork}"
                                              Foreground="White"
                                              FontSize="11"
                                              TextWrapping="Wrap"/>
                                </Border>
                            </StackPanel>
                        </Border>

                        <DataGrid ItemsSource="{Binding FtpServers}"
                                SelectedItem="{Binding SelectedFtpServer}"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                SelectionMode="Single">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="{DynamicResource IPAddress}"
                                                  Binding="{Binding IpAddress}"
                                                  Width="140"/>
                                <DataGridTextColumn Header="{DynamicResource Port}"
                                                  Binding="{Binding Port}"
                                                  Width="80"/>
                                <DataGridTextColumn Header="{DynamicResource ServerType}"
                                                  Binding="{Binding ServerType}"
                                                  Width="150"/>
                                <DataGridTemplateColumn Header="{DynamicResource Anonymous}" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                                                <Ellipse Width="10"
                                                         Height="10"
                                                         Fill="{Binding IsAnonymousAllowed, Converter={x:Static global:BoolToBrushConverter.Instance}}"/>
                                                <TextBlock Text="{Binding IsAnonymousAllowed}" FontSize="11"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="{DynamicResource SSL}" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding SupportsSSL}"
                                                      HorizontalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="{DynamicResource Response}"
                                                  Binding="{Binding ResponseTime, Converter={x:Static global:TimeSpanToMillisecondsConverter.Instance}}"
                                                  Width="100"/>
                                <DataGridTextColumn Header="{DynamicResource Banner}"
                                                  Binding="{Binding ServerBanner}"
                                                  Width="*"/>
                                <DataGridTextColumn Header="{DynamicResource FoundAt}"
                                                  Binding="{Binding DiscoveredAt, StringFormat='{}{0:HH:mm:ss}'}"
                                                  Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </TabItem>
            </TabControl>
        </DockPanel>
    </Border>
</UserControl>
